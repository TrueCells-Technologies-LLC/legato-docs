<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: Creating a Basic Component</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

<link rel="icon" type="image/png" href="favicon.ico">
</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Wireless M2M smooth and connected</div>
  </td>
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('component_basic_comp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Creating a Basic Component </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is how to create a basic component, written in C, that just prints "Hello World." when the process it is in starts up.</p>
<p>First, create a directory: the name becomes the name of the component.</p>
<div class="fragment"><pre class="fragment">
$ mkdir helloComp
</pre></div><p>Next, create a file called <b>"Component.cdef"</b> in the helloComp directory. The build tools look for this file.</p>
<div class="fragment"><pre class="fragment">
$ gedit helloComp/Component.cdef
</pre></div><p>Our minimalist Component.cdef file contains only a "sources:" section, listing our C source code file ("hi.c").</p>
<div class="fragment"><pre class="fragment">
sources:

    hi.c
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>The build tools figure out what language the source code is written in by looking at the filename extension. So, because our file "hi.c" ends in ".c", the build tools will try to use a C compiler to compile it into a library when it gets included in an executable.</dd></dl>
<p>Now we create our implementation file "hi.c":</p>
<div class="fragment"><pre class="fragment">
$ gedit helloComp/hi.c
</pre></div><p>It should contain the following:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="legato_8h.html">legato.h</a>&quot;</span>

<a class="code" href="le__event_loop_8h.html#abdb9187a56836a93d19cc793cbd4b7ec">COMPONENT_INIT</a>
{
    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Hello world.\n&quot;</span>);
}
</pre></div><p>This looks very similar to the original C "hello, world" program from Kernighan's and Richie's "The C Programming Language", except that:</p>
<ul>
<li>#include &lt;stdio.h&gt; is replaced with #include "legato.h"</li>
<li>main() is replaced with COMPONENT_INIT</li>
</ul>
<p>In fact, <a class="el" href="legato_8h.html">legato.h</a> will include stdio.h, along with a bunch of other system headers and Legato framework headers. This reduces the amount of time you have to spend including header files to get access to the functions and data types you need.</p>
<p>The COMPONENT_INIT macro is used to identify your <b> component initializer</b>. Every component must have a component initializer, and the code in it must get the component ready to have its exported interfaces accessed by other components.</p>
<p>By using component initializers instead of having each component implement their own main() function, we make it possible to run multiple components in the same executable, and even share a thread between those components. The main thread of the process (the main() function that is auto-generated by the build tools) will automatically call the component's initializer at the appropriate time in the start-up sequence of the process, based on the inter-dependencies between components. If component A is used by component B, then component A's initializer will be run before component B's initializer. Therefore, component B can safely call the API functions of component A, knowing that component A has already been initialized. This of course won't work if both components depend on each other (directly or indirectly through other components). That is one of the reasons why such dependency loops are not permitted between components. The framework will detect inter-component dependency loops at build time and terminate the build.</p>
<p>Component initializers don't take any parameters and don't return anything, but they <b> must always return </b> ; unless they experience a fatal error, in which case they <b> must terminate the process </b> with a non-zero exit code (which can be done using <a class="el" href="le__log_8h.html#a54b4b07f5396e19a8d9fca74238f4795">LE_FATAL()</a>, <a class="el" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT()</a>, etc. ).</p>
<dl class="note"><dt><b>Note:</b></dt><dd>If a component's initializer doesn't return, the process will not be able to finish initializing all the components that have been deployed to it and the process's main thread will never process any events that are queued to it.</dd></dl>
<p>In our "Hello World" example, we just use our component initializer to print "Hello world." to the log using <a class="el" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO()</a>.</p>
<p>Now let's package this into an application by creating an application definition:</p>
<div class="fragment"><pre class="fragment">
$ gedit hi.adef
</pre></div><p>that looks like this inside:</p>
<div class="fragment"><pre class="fragment">
executables:

    helloWorld ( helloComp )

processes:

run: (helloWorld)
</pre></div><p>And then build it like this:</p>
<div class="fragment"><pre class="fragment">
$ mkapp hi.adef -t ar7
</pre></div><p>And install on target like this:</p>
<div class="fragment"><pre class="fragment">
$ instapp hi.ar7 192.168.1.2
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>Your installed application output will display in /var/log/messages in the target device, not on the terminal you used to install the application. <hr/>
</dd></dl>
<p>Copyright (C) Sierra Wireless, Inc. 2012-2013. All rights reserved. Use of this work is subject to license. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
  <div id="nav-path" class="navpath">
    <ul>
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.7.6.1
        </div>
    </div>
</body>
</html>
