<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: Port Legacy Apps to Legato</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

<link rel="icon" type="image/png" href="favicon.ico">
</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Wireless M2M smooth and connected</div>
  </td>
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('port_legacy_apps.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Port Legacy Apps to Legato </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="port_legacy_apps.html#portSelfContained">Port Self-contained Apps</a> <br/>
 <a class="el" href="port_legacy_apps.html#portRootAccess">Porting Apps with Root Access</a> <br/>
 <a class="el" href="port_legacy_apps.html#portUsingAPIs">Use Legato APIs and Build System</a> <br/>
 <a class="el" href="port_legacy_apps.html#ownMainFunc">Use Your Own main() with Legato APIs</a></p>
<h2><a class="anchor" id="portSelfContained"></a>
Port Self-contained Apps</h2>
<p>Use this method to port your legacy apps if:</p>
<ul>
<li>the apps don't require root privileges.</li>
<li>you can't (or don't want to) make changes to source code.</li>
</ul>
<p>Here's the high-level steps <b>port your app to Legato</b>:</p>
<ul>
<li>Build the app’s executables and libraries using the legacy program’s build system.</li>
</ul>
<ul>
<li>Create an .adef file for your app.</li>
</ul>
<ul>
<li>Leave the <code>executables:</code> section in .adef empty.</li>
</ul>
<ul>
<li>Include files to be installed as part of the app (executables, libraries, configuration files, devices, etc.) in the <code>files:</code> section of .adef.</li>
</ul>
<ul>
<li>Include files that need to be imported into the sandbox from the target’s file system (e.g., /dev/zero) in the <code>import:</code> section of .adef.</li>
</ul>
<ul>
<li>Add <code>run:</code> lines in the <code>processes:</code> section in the .adef to define processes that should run in the app.</li>
</ul>
<ul>
<li>Run <code>mkapp</code> on the .adef file to build the app.</li>
</ul>
<ul>
<li>Run <code>instapp</code> on the built app file to install the app on target.</li>
</ul>
<ul>
<li>Run <code>app</code> <code>start</code> <code>appName</code> on target to start the app.</li>
</ul>
<p>Here's the <code>foo.adef</code> file (for application foo) that has executables bar1 and bar2 and needs library lib1. The application name should be the same as the .adef file name.</p>
<div class="fragment"><pre class="fragment">files:
    [rx] bar1   /bin/ 
    [rx] bar2   /bin/ 
    [r] lib1    /lib/
processes:
    run: (bar1) 
    run: (bar2) 
</pre></div><p>To build the app, run: </p>
<div class="fragment"><pre class="fragment"> mkapp foo.adef 
</pre></div><p>Other app settings (e.g., <code>faultAction</code>) can also be set in the .adef files. See <a class="el" href="processes_adef.html">adef processes</a>.</p>
<h2><a class="anchor" id="portRootAccess"></a>
Porting Apps with Root Access</h2>
<p>Use this method if you're going to change your source code. It's necessary if your legacy apps require root privileges or access to system resources like <code>/proc</code>. This means your app will be ported as a <b>non-sandboxed</b> Legato app.</p>
<p>In the .adef file, you'll have to turn-off sandboxing:</p>
<div class="fragment"><pre class="fragment">sandboxed: <span class="keyword">false</span>
</pre></div><h2><a class="anchor" id="portUsingAPIs"></a>
Use Legato APIs and Build System</h2>
<p>The preferred method to port a legacy app to Legato is to use the Legato build system, because it does framework initialization automatically.</p>
<p>To use Legato's build system:</p>
<p><b>Add</b> this to all source files that will call Legato APIs: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include @c &#39;legato.h&#39; </span>
</pre></div><p><b>Remove</b> the legacy program's <b>main()</b> function. Complete any app-specific initializations and processing in the macro <code>COMPONENT_INIT</code>. The Legato build system generates a main() function to initialize the Legato framework and call the COMPONENT_INIT macro. This must be done for each executable in the app.</p>
<p>Optionally, modify the source to use the Legato event loop.</p>
<p>Optionally, modify the source to use Legato signal handlers, memory pools, IPC, etc.</p>
<p><b>Write</b> the <b>adef</b> file for the app. The foo.adef file would be something like:</p>
<div class="fragment"><pre class="fragment">executables: 
    bar1 ( bar1.c ) 
    bar2 ( bar2.c )
processes: 
    run: (bar1) 
    run: (bar2)
</pre></div><p><b>Build</b> the app using <b>mkapp foo.adef -t target</b> where [target] is something like <code>ar7</code>.</p>
<p><b>Install</b> the app on target using <b>instapp</b>.</p>
<p>The event loop is an essential part of Legato's event-driven apps where programs act only when events are triggered; otherwise, these event-driven apps are idle and don't consume the CPU. Using the event loop, each thread in the program has its own event queue.</p>
<p>Legacy apps may choose not to use the Legato event loop and can instead run their programs using legacy event processing.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>If legacy event handling is used in conjunction with the Legato event loop, extreme care must be taken so the two systems don't interfere with each other.</dd></dl>
<p>Legato memory pools can also be used to allow programs to control memory use in a deterministic way; this avoids memory fragmentation, gives memory corruption protection, and allows Legato diagnostic tools to examine memory usage.</p>
<p>Legato apps don't use <code>malloc()</code> and <code>free()</code> directly. If legacy apps use malloc() and free(), they won't have the benefits of Legato memory pools.</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>If memory pools are used in conjunction with malloc() and free(), memory fragmentation could occur.</dd></dl>
<h2><a class="anchor" id="ownMainFunc"></a>
Use Your Own main() with Legato APIs</h2>
<p>Another option when porting legacy apps is to continue to use your own main() function and build system, and still take advantage of the Legato APIs.</p>
<p>To use the Legato APIs, you'll need to link the <code>liblegato.so</code> library and include <code><a class="el" href="legato_8h.html">legato.h</a></code> in any source files that call Legato APIs. The <code>_legato_InitFramework()</code> function should be called before any Legato API functions are called.</p>
<p>Related info:</p>
<p><a class="el" href="def_files.html">Legato Definition Files</a> <br/>
 <a class="el" href="app_creating.html">Create Applications</a> <br/>
 <a class="el" href="component_writing.html">Write Components</a></p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. All rights reserved. Use of this work is subject to license. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
  <div id="nav-path" class="navpath">
    <ul>
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.7.6.1
        </div>
    </div>
</body>
</html>
