<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: Audio</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_audio.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Audio </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__audio__interface_8h.html">API Reference</a></p>
<hr/>
<p>The Audio API handles audio interfaces including play or listen supported formats.</p>
<p>A Legato device can use several audio interfaces. You choose the input and output interfaces to tie together. The Audio stream-related to a particular interface is represented with an 'Audio Stream Reference'.</p>
<p>You can create your own audio path by connecting several audio streams together using audio connectors.</p>
<p>An audio path can support more than two audio interfaces. You can have a basic output audio path of a voice call to connect the Modem Voice Received interface with the Speaker interface, and at the same time, the Modem Voice Received interface can be also connected to a Recorder Device interface.</p>
<h1><a class="anchor" id="le_audio_configuration"></a>
Configure the Audio</h1>
<p>The audio profile can be set with the <a class="el" href="le__audio__interface_8h.html#ae2e6553f8125a30676d31f5cbd43a3b8">le_audio_SetProfile()</a> function. The pre-configured profiles are defined with <code>le_audio_Profile_t</code> enumeration type.</p>
<dl class="section warning"><dt>Warning</dt><dd>Ensure to check the list of supported audio profiles for your specific platform.</dd></dl>
<p>The audio profile in use can be retrieved with the <a class="el" href="le__audio__interface_8h.html#a1bf9091e0068a75a34fdf638ce0f2bc3">le_audio_GetProfile()</a> function.</p>
<p>Then, the following functions let you enable or disable the audio settings on the selected audio interface:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#ac1af23c9febed1378620370a6961ce89">le_audio_EnableNoiseSuppressor()</a>/le_audio_DisableNoiseSuppressor(): Noise Suppressor.</li>
<li><a class="el" href="le__audio__interface_8h.html#a54df27e4ab733a1f50e17903d7a9ae88">le_audio_EnableEchoCanceller()</a>/ <a class="el" href="le__audio__interface_8h.html#afc413a569b1e7eb877a3f98c2b52b05d">le_audio_DisableEchoCanceller()</a>: Echo Canceller.</li>
<li><a class="el" href="le__audio__interface_8h.html#adedb3bb7e372fffa406f001bdb353e96">le_audio_EnableFirFilter()</a>/ <a class="el" href="le__audio__interface_8h.html#ae5be820a7a167c307d64ea2c15b0abb4">le_audio_DisableFirFilter()</a>: downlink FIR Filter (Finite Impulse Response).</li>
<li><a class="el" href="le__audio__interface_8h.html#ad5eee81a34cc554ddef8a29c64bcd498">le_audio_EnableIirFilter()</a>/ <a class="el" href="le__audio__interface_8h.html#af7958cd14c83c479ede6ae7a7953461b">le_audio_DisableIirFilter()</a>: downlink IIR Filter (Infinite Impulse Response).</li>
<li><a class="el" href="le__audio__interface_8h.html#ac4978d8d632269730c67e27d66fba818">le_audio_EnableAutomaticGainControl()</a>/ <a class="el" href="le__audio__interface_8h.html#a364cdff3d9fa7b2ced00ef92c0c4e9f7">le_audio_DisableAutomaticGainControl()</a>: automatic gain on the selected audio stream.</li>
</ul>
<h1><a class="anchor" id="le_audio_interfaces"></a>
Open/Close an Audio Interface</h1>
<p>The following functions let you select the desired interface:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#a74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic()</a>: returns an Audio Stream Reference of the analog audio signal coming from the microphone input.</li>
<li><a class="el" href="le__audio__interface_8h.html#a5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker()</a>: returns an Audio Stream Reference of the analog audio signal routed to the Speaker output.</li>
<li><a class="el" href="le__audio__interface_8h.html#acd8be89289067cef9441a8ed1d891146">le_audio_OpenUsbRx()</a>: returns an Audio Stream Reference of the digitized audio signal coming from an external device connected via USB Audio Class.</li>
<li><a class="el" href="le__audio__interface_8h.html#adb38f11ac78cf99160c19f69b4db0eb8">le_audio_OpenUsbTx()</a>: returns an Audio Stream Reference of the digitized audio signal routed to an external device connected via USB Audio Class.</li>
<li><a class="el" href="le__audio__interface_8h.html#aa0f0b5fcab8844c67a936d88fa050cf5">le_audio_OpenPcmRx()</a>: it returns an Audio Stream Reference of the digitized audio signal coming from an external device connected via the PCM interface.</li>
<li><a class="el" href="le__audio__interface_8h.html#a5e112543e8525775aa670dc71b320766">le_audio_OpenPcmTx()</a>: it returns an Audio Stream Reference of the digitized audio signal routed to an external device connected via the PCM interface.</li>
<li><a class="el" href="le__audio__interface_8h.html#a9e7d0042c4f422554eb10d64535608e5">le_audio_OpenI2sRx()</a>: it returns an Audio Stream Reference of the digitized audio signal coming from an external device connected via the I2S interface.</li>
<li><a class="el" href="le__audio__interface_8h.html#a2633c1368adf60e342d7cadbbfa6278b">le_audio_OpenI2sTx()</a>: it returns an Audio Stream Reference of the digitized audio signal routed to an external device connected via the I2S interface.</li>
<li><a class="el" href="le__audio__interface_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx()</a>: returns an Audio Stream Reference of the digitized audio signal coming from a voice call. The audio format is negotiated with the network when the call is established.</li>
<li><a class="el" href="le__audio__interface_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx()</a>: returns an Audio Stream Reference of the digitized audio signal routed to a voice call. The audio format is negotiated with the network when the call is established.</li>
</ul>
<p>Multiple users can own the same stream at the same time.</p>
<p><a class="el" href="le__audio__interface_8h.html#a3f87e41dabde5bfb1170df527c380b9d">le_audio_GetDefaultPcmTimeSlot()</a> can be called to get the default PCM time slot used on the current platform.</p>
<p><a class="el" href="le__audio__interface_8h.html#a0b727e15c16fffe10cdd5d345b297194">le_audio_GetDefaultI2sMode()</a> can be called to get the default I2s channel mode slot used on the current platform.</p>
<p><a class="el" href="le__audio__interface_8h.html#a7e50add53e328c1dc6b680188990ebbb">le_audio_GetFormat()</a> can be called to get the audio format of an input or output stream.</p>
<p>Call <a class="el" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close()</a> to release it. If several users own the same, corresponding stream reference, the interface will close only after the last user releases the audio stream.</p>
<p>You can configure the PCM interface with the <a class="el" href="le__audio__interface_8h.html#ae7c9d76c5377ad5fae13b24477827f45">le_audio_SetPcmSamplingRate()</a>, <a class="el" href="le__audio__interface_8h.html#ab3678e77c8d69f248cd339042bd824cc">le_audio_SetPcmSamplingResolution()</a> and <a class="el" href="le__audio__interface_8h.html#a593682daa95aec349e48144f5b46c658">le_audio_SetPcmCompanding()</a> functions. This function must be called before activating an audio path with the PCM interface, in other words you must call this function before connecting the PCM Stream to a connector.</p>
<p>In addition, the <a class="el" href="le__audio__interface_8h.html#a36779982278d3f965286582f38917247">le_audio_GetPcmSamplingRate()</a>, <a class="el" href="le__audio__interface_8h.html#a70fbe5e1ae02033e89ad04bbf1ed2b39">le_audio_GetPcmSamplingResolution()</a> and <a class="el" href="le__audio__interface_8h.html#aab9a28f3c695b90f8b9f622eb401f6cf">le_audio_GetPcmCompanding()</a> functions allows you to retrieve the PCM interface configuration.</p>
<h1><a class="anchor" id="le_audio_streams"></a>
Control an Audio Stream</h1>
<p>Once the users get an Audio Stream reference, they can control it with the following functions:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#ad62587dacf0cb087697a62fb9f41d938">le_audio_SetGain()</a>: allows the user to adjust the gain of an audio stream (0 means 'muted', 100 is the maximum gain value).</li>
<li><a class="el" href="le__audio__interface_8h.html#a51a86829cdd6f27234f482e5dbb6c933">le_audio_GetGain()</a>: allows the User to retrieve the gain of an audio stream (0 means 'muted', 100 is the maximum gain value).</li>
<li><a class="el" href="le__audio__interface_8h.html#a147e97c49dbc003f63df78f97d5fca32">le_audio_Mute()</a>: allows the user to mute an audio stream.</li>
<li><a class="el" href="le__audio__interface_8h.html#adad24547293481964039efe56bc14e2b">le_audio_Unmute()</a>: allows the user to unmute an audio stream.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The hardware may or may not support the full 0-100 resolution, and if you want to see what was actually set call <a class="el" href="le__audio__interface_8h.html#a51a86829cdd6f27234f482e5dbb6c933">le_audio_GetGain()</a> after <a class="el" href="le__audio__interface_8h.html#ad62587dacf0cb087697a62fb9f41d938">le_audio_SetGain()</a> to get the real value.</dd></dl>
<p>The users have also the possibility to register a handler function to catch some stream-related notifications such as errors or audio file's events:</p>
<p><a class="el" href="le__audio__interface_8h.html#a822fb40912ac25935c2d1ac0b1033804">le_audio_AddStreamEventHandler()</a> function installs a handler for stream notifications. You can specify the types of events to notify by passing a bit mask as a parameter (cf. <code>le_audio_StreamEventBitMask_t</code>).</p>
<p><a class="el" href="le__audio__interface_8h.html#a5d8bf5faec98550ff0283d17d09faceb">le_audio_RemoveStreamEventHandler()</a> function removes the stream handler function.</p>
<dl class="section warning"><dt>Warning</dt><dd>Only audio file-related events are managed in the current Legato's version.</dd></dl>
<p>Once the stream event handler is called, the user can call the different functions to retrieve the event's value:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#afb28f94b413384a4a26074b9f6a9370b">le_audio_GetFileEvent()</a> gets the event's value related to audio file's events.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Only audio file-related functions are available in the current Legato's version.</dd></dl>
<p>The code sample below shows how the User can install a file's event handler. </p>
<div class="fragment"><div class="line"><span class="comment">// Handler function for Stream Event Notifications.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MyStreamEventHandler</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>          streamRef,</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a7bfaf3df0b1b684584ba80ac5f9afdce">le_audio_StreamEventBitMask_t</a> streamEventMask,</div>
<div class="line">    <span class="keywordtype">void</span>*                         contextPtr</div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#af639aaf073c155db217b12f353153a55">le_audio_FileEvent_t</a> event;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (streamEventMask &amp; LE_AUDIO_BITMASK_FILE_EVENT)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="le__audio__interface_8h.html#afb28f94b413384a4a26074b9f6a9370b">le_audio_GetFileEvent</a>(streamRef, &amp;event) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">switch</span>(event)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="le__audio__interface_8h.html#af639aaf073c155db217b12f353153a55a454cb1ac91a0bb29c611dad8431bdd98">LE_AUDIO_FILE_ENDED</a>:</div>
<div class="line">                    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;File event is LE_AUDIO_FILE_ENDED.&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="le__audio__interface_8h.html#af639aaf073c155db217b12f353153a55af0eaf1d31bbaed8a9202bbf2d4201f2b">LE_AUDIO_FILE_ERROR</a>:</div>
<div class="line">                    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;File event is LE_AUDIO_FILE_ERROR.&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// I must install my audio file event handler as follows:</span></div>
<div class="line">[...]</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> myAudioFileFd = -1;</div>
<div class="line"><a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> fileAudioRef = NULL;</div>
<div class="line"><a class="code" href="le__audio__interface_8h.html#a44fd55b7ee1516cda969773ff83f8450">le_audio_StreamEventHandlerRef_t</a> streamHandlerRef = NULL;</div>
<div class="line"></div>
<div class="line">myAudioFileFd=open(<span class="stringliteral">&quot;/myAudioFile.wav&quot;</span>, O_RDONLY);</div>
<div class="line"></div>
<div class="line">fileAudioRef = <a class="code" href="le__audio__interface_8h.html#a92eb1b6377f50ff07b97c5b8546f01ec">le_audio_OpenPlayer</a>();</div>
<div class="line"><a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((fileAudioRef==NULL), <span class="stringliteral">&quot;le_audio_OpenPlayer returns NULL!&quot;</span>);</div>
<div class="line"></div>
<div class="line">streamHandlerRef = <a class="code" href="le__audio__interface_8h.html#a822fb40912ac25935c2d1ac0b1033804">le_audio_AddStreamEventHandler</a>(fileAudioRef,</div>
<div class="line">                                                  LE_AUDIO_BITMASK_FILE_EVENT,</div>
<div class="line">                                                  MyStreamEventHandler,</div>
<div class="line">                                                  NULL);</div>
<div class="line"><a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((streamHandlerRef==NULL), <span class="stringliteral">&quot;AddFileEventHandler returns NULL!&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, fileAudioRef);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Play the file</span></div>
<div class="line"><a class="code" href="le__audio__interface_8h.html#a31f20b5413eda0ac4068c5a3dd07ce11">le_audio_Play</a>(fileAudioRef, myAudioFileFd);</div>
<div class="line"></div>
<div class="line">[...]</div>
</div><!-- fragment --><h1><a class="anchor" id="le_audio_connectors"></a>
Create Audio connectors</h1>
<p>You can create your own audio path by connecting several audio streams together.</p>
<p><a class="el" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector()</a> function creates a reference to an audio connector.</p>
<p>You can tie an audio stream to a connector by calling the <a class="el" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect()</a> function.</p>
<p>You can remove an audio stream from a connector by calling the <a class="el" href="le__audio__interface_8h.html#a6b88df9301038375701e4c15a4c8aaf0">le_audio_Disconnect()</a> function.</p>
<p>When finished with it, delete it using the <a class="el" href="le__audio__interface_8h.html#a3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector()</a> function.</p>
<h1><a class="anchor" id="le_audio_formats"></a>
Specifying audio formats</h1>
<p>The encoding audio format can be specified to (or retrieved from) the audio interfaces that support this option. The format parameter is a string containing the IANA specified encoding format name for Real-Time protocol (RTP).</p>
<p>The complete list of the audio encoding format names can be found on the IANA organization web site (<a href="http://www.iana.org">http://www.iana.org</a>).</p>
<p>Function that gets the current audio format for an open interface is:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#a7e50add53e328c1dc6b680188990ebbb">le_audio_GetFormat()</a></li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Ensure to check the list of supported audio formats for your specific platform.</dd></dl>
<p>Some examples of audio formats:</p>
<ul>
<li>"L16-8K": Linear PCM 16-bit audio @ 8KHz</li>
<li>"L16-16K": Linear PCM 16-bit audio @ 16KHz</li>
<li>"GSM": European GSM Full Rate @ 8KHz (GSM 06.10)</li>
<li>"GSM-EFR": ITU-T GSM Enhanced Full Rate @ 8KHz (GSM 06.60)</li>
<li>"GSM-HR-08": ITU-T GSM Half Rate @ 8KHz (GSM 06.20)</li>
<li>"AMR": Adaptive Multi-Rate - Full Rate @ 8KHz</li>
<li>"AMR-HR": Adaptive Multi-Rate - Half Rate @ 8KHz</li>
<li>"AMR-WB": Adaptive Multi-Rate Wideband @ 16KHz</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The string is not case sensitive.</dd></dl>
<h1><a class="anchor" id="le_audio_file_pb_rec"></a>
Play and record audio</h1>
<p>An audio file can be played to any active output interfaces.</p>
<p>You must open a player interface by calling:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#a92eb1b6377f50ff07b97c5b8546f01ec">le_audio_OpenPlayer()</a>: returns an Audio Stream Reference for file playback. An audio file can be played on the local audio interface like Speaker, USB Tx, PCM Tx, I2S Tx or on the remote audio interface Modem Voice Tx depending the kind of connector (input or output) is tied to.</li>
</ul>
<p>Audio file recording can be done from any active input interfaces.</p>
<p>You must open a "File Recording" interface by calling:</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#aeac35459c36748a4471b6d45f1ebeb24">le_audio_OpenRecorder()</a>: returns an Audio Stream Reference for file recording. The local audio interface like Microphone, USB Rx, PCM Rx, I2S Rx is recorded into an audio file; or the Modem Voice Rx remote audio interface is recorded into an audio file, depending the kind of connector (input or output) is tied to.</li>
<li><a class="el" href="le__audio__interface_8h.html#a31f20b5413eda0ac4068c5a3dd07ce11">le_audio_Play()</a>: must be called to play a specified file.</li>
</ul>
<p>A play can be done only on a connected stream. For instance, the "I2S Tx", "Modem Voice Rx" and "Player" must be previously connected before playing a file.</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#abdad9dc8ed37fff3ec1f94783ff9e01b">le_audio_Record()</a>: must be called to record in a specified file.</li>
</ul>
<p>A record can be done only on a connected stream. For instance, the "I2S Rx", "Modem Voice Tx" and "Recorder" must be previously connected before recording a file.</p>
<ul>
<li><a class="el" href="le__audio__interface_8h.html#a4aebc6e8cdc4389c375e93418823af71">le_audio_Stop()</a>: can be called to stop a play/record. The playback/record is stopped playing/recording, the read/write position indicator associated with the file stream is rewound to the beginning of the file. A new file can be played/recorded using <a class="el" href="le__audio__interface_8h.html#a31f20b5413eda0ac4068c5a3dd07ce11">le_audio_Play()</a>/le_audio_Record().</li>
<li><a class="el" href="le__audio__interface_8h.html#a80343ca9800ab80f818bbe0361bb226b">le_audio_Pause()</a>: can be called to pause a play/record. The file playing/recording is put in hold, the read/write position indicator of the file is not moved.</li>
<li><a class="el" href="le__audio__interface_8h.html#a1dba6618bd8fc9835869ee72c3fbd850">le_audio_Resume()</a>: can be called to resume a paused play/record. The file playing/recording continue at the file's position indicator held after the pause.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Only .wav file format is currently supported.</dd></dl>
<p>The function below is an example of how a file can be played to the Modem Voice Tx output interface. The audio of the voice call is redirected to the I2S interfaces. This function simply plays a voice prompt to the remote party when the voice call is established.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ConnectAudioAndPlayVoicePromptToRemoteParty</div>
<div class="line">(</div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I get the audio from the voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> mdmRxAudioRef = <a class="code" href="le__audio__interface_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> mdmTxAudioRef = <a class="code" href="le__audio__interface_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I get the I2S interface references.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> i2sTxRef = <a class="code" href="le__audio__interface_8h.html#a2633c1368adf60e342d7cadbbfa6278b">le_audio_OpenI2sTx</a>(<a class="code" href="le__audio__interface_8h.html#a0b727e15c16fffe10cdd5d345b297194">le_audio_GetDefaultI2sMode</a>());</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> i2sRxRef = <a class="code" href="le__audio__interface_8h.html#a9e7d0042c4f422554eb10d64535608e5">le_audio_OpenI2sRx</a>(<a class="code" href="le__audio__interface_8h.html#a0b727e15c16fffe10cdd5d345b297194">le_audio_GetDefaultI2sMode</a>());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I create the audio connectors.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a> audioInputConnectorRef = <a class="code" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a> audioOutputConnectorRef = <a class="code" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The voice call&#39;s audio is redirected to I2S interfaces.</span></div>
<div class="line">    <span class="keywordflow">if</span> (mdmRxAudioRef &amp;&amp; mdmTxAudioRef &amp;&amp; i2sTxRef &amp;&amp; i2sRxRef &amp;&amp;</div>
<div class="line">        audioInputConnectorRef &amp;&amp; audioOutputConnectorRef)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, i2sRxRef);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, mdmTxAudioRef);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioOutputConnectorRef, i2sTxRef);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioOutputConnectorRef, mdmRxAudioRef);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I get the interface reference for file playback.</span></div>
<div class="line">    <span class="keywordtype">int</span> fd = open(<span class="stringliteral">&quot;/myvoiceprompt.wav&quot;</span>, O_RDONLY));</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> fileAudioRef = <a class="code" href="le__audio__interface_8h.html#a92eb1b6377f50ff07b97c5b8546f01ec">le_audio_OpenPlayer</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The audio file is played on the input connector, the remote party can now hear the voice</span></div>
<div class="line">    <span class="comment">// prompt.</span></div>
<div class="line">    <span class="keywordflow">if</span> (fileAudioRef &amp;&amp; audioInputConnectorRef)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, fileAudioRef);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a31f20b5413eda0ac4068c5a3dd07ce11">le_audio_Play</a>(fileAudioRef, fd);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="le_audio_dtmf"></a>
DTMF</h1>
<p>The application must register a handler function to detect incoming DTMF characters on a specific input audio stream. The <a class="el" href="le__audio__interface_8h.html#a6e65275798c0db287fc1b540cdc0db8b">le_audio_AddDtmfDetectorHandler()</a> function installs a handler for DTMF detection.</p>
<p>The <a class="el" href="le__audio__interface_8h.html#a7fd6191ed6ff512407bfe01d20a51459">le_audio_RemoveDtmfDetectorHandler()</a> function uninstalls the handler function.</p>
<p>The DTMFs are: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, *, #, A, B, C, D. Not case sensitive.</p>
<dl class="section note"><dt>Note</dt><dd>The DTMF decoding works only on an active audio path.</dd></dl>
<h1><a class="anchor" id="le_audio_samples"></a>
Code samples</h1>
<p>The following two code samples show how to create different audio paths for an incoming voice call.</p>
<p>The first example has the audio path depending on an USB Audio handset. The <b>ConnectVoiceCallAudio()</b> function creates this audio path. A USB Audio handset plugged in and fully operationnal, will redirect the call audio to the handset; otherwise, it will redirect the call to the default microphone and speaker.</p>
<p>Use DisconnectVoiceCallAudio() to delete the audio path.</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> ConnectVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioInputConnectorRefPtr,  <span class="comment">// [OUT] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioOutputConnectorRefPtr, <span class="comment">// [OUT] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmRxAudioRefPtr,           <span class="comment">// [OUT] Received voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmTxAudioRefPtr,           <span class="comment">// [OUT] Transmitted voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     deviceRxAudioRefPtr,        <span class="comment">// [OUT] Received device audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     deviceTxAudioRefPtr         <span class="comment">// [OUT] Transmitted device audio stream.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I get the audio from the voice call.</span></div>
<div class="line">    *mdmRxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    *mdmTxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If I cannot get the audio from the voice call, I return an error.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((*mdmRxAudioRefPtr == NULL) || (*mdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">// I close the audio interfaces that have failed to open.</span></div>
<div class="line">            <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmRxAudioRefPtr);</div>
<div class="line">            <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmTxAudioRefPtr);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I create the audio connectors.</span></div>
<div class="line">    *audioInputConnectorRefPtr = <a class="code" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line">    *audioOutputConnectorRefPtr = <a class="code" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I verify if my Audio USB handset is plugged and operational before trying to use it.</span></div>
<div class="line">    <span class="keywordflow">if</span>(IsMyUSBHandsetPlugged() == TRUE)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// I can redirect the audio to my USB handset using linear PCM audio format (PCM 16bits @ 16KHz)</span></div>
<div class="line">        *deviceRxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#acd8be89289067cef9441a8ed1d891146">le_audio_OpenUsbRx</a>();</div>
<div class="line">        *deviceTxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#adb38f11ac78cf99160c19f69b4db0eb8">le_audio_OpenUsbTx</a>();</div>
<div class="line"></div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioInputConnectorRefPtr, *deviceRxAudioRefPtr);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioOutputConnectorRefPtr, *deviceTxAudioRefPtr);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// There is no USB Audio handset, I redirect the audio to the in-built Microphone and Speaker.</span></div>
<div class="line">        *deviceRxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#a74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic</a>();</div>
<div class="line">        *deviceTxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#a5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker</a>();</div>
<div class="line"></div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioInputConnectorRefPtr, *deviceRxAudioRefPtr);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioOutputConnectorRefPtr, *deviceTxAudioRefPtr);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I tie the audio from the voice call to the connectors.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioInputConnectorRefPtr, *mdmTxAudioRefPtr);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioOutputConnectorRefPtr, *mdmRxAudioRefPtr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> DisconnectVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioInputConnectorRef,  <span class="comment">// [IN] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioOutputConnectorRef, <span class="comment">// [IN] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     mdmRxAudioRef,           <span class="comment">// [IN] Received voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     mdmTxAudioRef,           <span class="comment">// [IN] Transmitted voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     deviceRxAudioRef,        <span class="comment">// [IN] Received device audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     deviceTxAudioRef         <span class="comment">// [IN] Transmitted device audio stream.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// The call is terminated, I can close its audio interfaces.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(mdmRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(mdmTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I close all the device interfaces.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(deviceRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(deviceTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I delete the Audio connector references.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector</a>(audioInputConnectorRef);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector</a>(audioOutputConnectorRef);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The next code sample uses specific functions to deal with a new 'Incoming call' event during a call already in progress.</p>
<p>If no call is in progress, use the ConnectVoiceCallAudio() function to redirect the call audio to the in-built Microphone and Speaker.</p>
<p>If a new call is incoming, and considered a high priority call, you must mute the audio of the first call, and then connect the new call to your current audio path. Use SwitchVoiceCallAudio() for these actions.</p>
<p>When the high priority call terminates, you can return back to your previous call and reactivate its audio with the SwitchBackVoiceCallAudio() function.</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> ConnectVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioInputConnectorRefPtr,  <span class="comment">// [OUT] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioOutputConnectorRefPtr, <span class="comment">// [OUT] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmRxAudioRefPtr,           <span class="comment">// [OUT] Received voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmTxAudioRefPtr,           <span class="comment">// [OUT] Transmitted voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     micRefPtr,                  <span class="comment">// [OUT] Microphone stream.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     speakerRefPtr               <span class="comment">// [OUT] Speaker stream.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    *mdmRxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    *mdmTxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If I cannot get the audio from the voice call, I return an error.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((*mdmRxAudioRefPtr == NULL) || (*mdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">// I close the audio interfaces that  have failed to open.</span></div>
<div class="line">            <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmRxAudioRefPtr);</div>
<div class="line">            <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmTxAudioRefPtr);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *audioInputConnectorRefPtr = <a class="code" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line">    *audioOutputConnectorRefPtr = <a class="code" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Redirect audio to the in-built Microphone and Speaker.</span></div>
<div class="line">    *speakerRefPtr = <a class="code" href="le__audio__interface_8h.html#a5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker</a>();</div>
<div class="line">    *micRefPtr = <a class="code" href="le__audio__interface_8h.html#a74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioInputConnectorRefPtr, *micRefPtr);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioInputConnectorRefPtr, *mdmTxAudioRefPtr);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioOutputConnectorRefPtr, *speakerRefPtr);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioOutputConnectorRefPtr, *mdmRxAudioRefPtr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> SwitchVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioInputConnectorRef,  <span class="comment">// [IN] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioOutputConnectorRef, <span class="comment">// [IN] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     oldMdmRxAudioRef,        <span class="comment">// [IN] Received audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     oldMdmTxAudioRef,        <span class="comment">// [IN] Transmitted audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*    newMdmRxAudioRefPtr,     <span class="comment">// [OUT] Received audio stream of the new voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*    newMdmTxAudioRefPtr      <span class="comment">// [OUT] Transmitted audio stream of the new voice call.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ((newMdmRxAudioRefPtr == NULL)     ||</div>
<div class="line">        (newMdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cabe505065132f6e8850da6f476d8fb783">LE_BAD_PARAMETER</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *newMdmRxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    *newMdmTxAudioRefPtr = <a class="code" href="le__audio__interface_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If I cannot get the audio from the voice call, I return an error.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((*newMdmRxAudioRefPtr == NULL) || (*newMdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// I close the audio interfaces that have failed to open.</span></div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*newMdmRxAudioRefPtr);</div>
<div class="line">        <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*newMdmTxAudioRefPtr);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I mute the previous call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a147e97c49dbc003f63df78f97d5fca32">le_audio_Mute</a>(oldMdmRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a147e97c49dbc003f63df78f97d5fca32">le_audio_Mute</a>(oldMdmTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I connect the new incoming call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (audioInputConnectorRef, *newMdmTxAudioRefPtr);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (audioOutputConnectorRef, *newMdmRxAudioRefPtr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> SwitchBackVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  oldMdmRxAudioRef, <span class="comment">// [IN] Received audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  oldMdmTxAudioRef, <span class="comment">// [IN] Transmitted audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  newMdmRxAudioRef, <span class="comment">// [IN] Received audio stream of the new voice call.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  newMdmTxAudioRef  <span class="comment">// [IN] Transmitted audio stream  of the new voice call.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I can delete the new call audio interfaces.</span></div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(newMdmRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(newMdmTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I can re-open the previous call streaming.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__audio__interface_8h.html#adad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(oldMdmRxAudioRef) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__audio__interface_8h.html#adad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(oldMdmTxAudioRef) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><hr/>
<p>Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
