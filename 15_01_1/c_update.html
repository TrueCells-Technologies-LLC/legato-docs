<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: Software Update</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_update.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Software Update </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__update__interface_8h_source.html">API Reference</a></p>
<hr/>
<p>This API is used to control updates (install/remove) for the Legato application/framework/ system/firmware.</p>
<p>This is the typical calling update sequence:</p>
<ul>
<li>[MANDATORY] Client will provide update file descriptor (where manifest string is prepended at the beginning) via le_update_Create() api. Updates service provider extracts, parses and verifies the manifest, and returns a handle in success scenario. See the update file and manifest documentation for more details.</li>
<li>[OPTIONAL] Client can request task type (e.g., update or remove) by calling le_update_GetType() api. Client must call le_update_Create() api before calling this api. Client must provide a valid handle (received in step 1) as parameter.</li>
<li>[OPTIONAL] Client may register any callback function for status update based on task type. It's highly recommended to register callback function as client can only know its requested update status via callback function.</li>
<li>[MANDATORY] Client can call le_update_Start() to start update task. It's an asynchronous API (returns after the update process has started, but doesn't verify if the update has finished). Update service provider will notify the status of update task to client via callback function. If no callback is registered, the client won't get any notification.</li>
<li>[OPTIONAL] Client may request to cancel an update task in any stage of process by calling le_update_Cancel(). It's not guaranteed; an update task can only be cancelled if it's safe to do so.</li>
<li>[MANDATORY] Client needs to call le_update_Delete() to deallocate handle.</li>
</ul>
<h1><a class="anchor" id="update_example"></a>
Update API Usage Example</h1>
<p>This code sample calls an update service provider API to perform an update:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SoftwareUpdate</div>
<div class="line">(</div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> fd = 0;  <span class="comment">// Update data coming via STDIN</span></div>
<div class="line"></div>
<div class="line">    le_update_HandleRef_t Handle;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create and update handle.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((Handle = le_update_Create(fd)) == NULL)</div>
<div class="line">    {</div>
<div class="line">         perror(<span class="stringliteral">&quot;Update failure, exiting.&quot;</span>);</div>
<div class="line">         exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Register callback function.</span></div>
<div class="line">    <span class="keywordflow">if</span> (le_update_AddProgressHandler(Handle, UpdateProgressHandler, NULL) == NULL)</div>
<div class="line">    {</div>
<div class="line">         perror(<span class="stringliteral">&quot;Can&#39;t register status handler&quot;</span>);</div>
<div class="line">         exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start update process(asynchronous). Completion will be notified via callback function.</span></div>
<div class="line">    <span class="keywordflow">if</span> (le_update_Start(Handle) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div>
<div class="line">    {</div>
<div class="line">         perror(<span class="stringliteral">&quot;Can&#39;t start update task !&quot;</span>);</div>
<div class="line">         exit(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Sample callback function implementation.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> UpdateProgressHandler</div>
<div class="line">(</div>
<div class="line">  le_update_HandleRef_t handle,</div>
<div class="line">  le_update_State_t updateState,</div>
<div class="line">  uint8_t percentDone,</div>
<div class="line">  <span class="keywordtype">void</span>* contextPtr</div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span>(updateState)</div>
<div class="line">    {</div>
<div class="line">         <span class="keywordflow">case</span> LE_UPDATE_STATE_INIT:</div>
<div class="line">              printf(<span class="stringliteral">&quot;STARTED\n&quot;</span>);</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">         <span class="keywordflow">case</span> LE_UPDATE_STATE_DATA_TX_STARTED:</div>
<div class="line">             printf(<span class="stringliteral">&quot;Copying data ..\n&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">         <span class="keywordflow">case</span> LE_UPDATE_STATE_INSTALL_STARTED:</div>
<div class="line">             printf(<span class="stringliteral">&quot;Installation started\n&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">         <span class="keywordflow">case</span> LE_UPDATE_STATE_REMOVE_STARTED:</div>
<div class="line">             printf(<span class="stringliteral">&quot;Remove started\n&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">         <span class="keywordflow">case</span> LE_UPDATE_STATE_COMPLETED:</div>
<div class="line">             printf(<span class="stringliteral">&quot;FINISHED\n&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">         <span class="keywordflow">case</span> LE_UPDATE_STATE_FAILED:</div>
<div class="line">             perror(<span class="stringliteral">&quot;FAILED\n&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">         <span class="keywordflow">default</span>:</div>
<div class="line">             perror(<span class="stringliteral">&quot;Bad state\n&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
