<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: Create App</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('basic_apps_comp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Create App </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>These are the basic steps to build an appwritten in C to print <code>Hello World.</code> when the process it's in starts up:</p>
<ul>
<li>create an executable and component.</li>
<li>convert them to an app.</li>
<li>build and run the app on the dev host.</li>
<li>cross-build and run the app on a target device.</li>
<li>add third-party binaries and other resource files into an app.</li>
</ul>
<h1><a class="anchor" id="basicAppsComp_createDir"></a>
Create Directory</h1>
<p><code>1</code>. Create a directory: the directory name will become the component name.</p>
<pre class="fragment">$ mkdir helloComp
</pre><h1><a class="anchor" id="basicAppsComp_c"></a>
Create C Source File</h1>
<p><code>2</code>. Create our source (implementation file) <code>hello.c:</code> </p>
<pre class="fragment">$ gedit helloComp/hello.c
</pre><p>It should contain the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="legato_8h.html">legato.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__event_loop_8h.html#abdb9187a56836a93d19cc793cbd4b7ec">COMPONENT_INIT</a></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Hello world.\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>This looks similar to the original C <code>hello</code>, world program from Kernighan's and Richie's "The C Programming Language", except that:</p>
<ul>
<li>#include &lt;stdio.h&gt; is replaced with #include "legato.h"</li>
<li>main() is replaced with COMPONENT_INIT</li>
</ul>
<p>In fact, <a class="el" href="legato_8h.html">legato.h</a> will include stdio.h, along with a bunch of other system headers and Legato framework headers. This reduces the amount of time you have to spend including header files to get access to the functions and data types you need.</p>
<p>The build tools figure out what language the source code is written in by looking at the filename extension. So, because our file <code>hi.c</code> ends in <code></code>.c, the build tools will try to use a C compiler to compile it into a library when it gets included in an executable.</p>
<h1><a class="anchor" id="basicAppsComp_componentInit"></a>
Component Initializer</h1>
<p>The <code>COMPONENT_INIT</code> macro is used to identify your <b> component initializer</b>. Every component must have a component initializer.</p>
<p>By using component initializers instead of having each component implement their own main() function, it's possible to run multiple components in the same executable and even share a thread between those components.</p>
<p>The main process thread (the main() function auto-generated by the build tools) will automatically call the component's initializer at the appropriate time during the process start-up sequence (based on the inter-dependencies between components). If component A is used by component B, then component A's initializer will be run before component B's initializer. Then component B can safely call the API functions of component A knowing that component A has already been initialized. This won't work if both components depend on each other (directly or indirectly through other components). That's one reason why dependency loops are not permitted between components. The framework will detect inter-component dependency loops at build time and terminate the build.</p>
<p>Component initializers don't take any parameters and don't return anything, but they <b> must always return </b> . Unless they experience a fatal error, in which case they <b> must terminate the process </b> with a non-zero exit code (which can be done using <code><a class="el" href="le__log_8h.html#a54b4b07f5396e19a8d9fca74238f4795">LE_FATAL()</a></code>, <code><a class="el" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT()</a></code>, etc. ).</p>
<dl class="section note"><dt>Note</dt><dd>If a component's initializer doesn't return, the process will not be able to finish initializing all the components that have been deployed to it and the process's main thread will never process any events that are queued to it.</dd></dl>
<p>In our "Hello World" example, we just use our component initializer to print <code>Hello</code> world to the log using <code><a class="el" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808" title="Informational message. Normally expected. ">LE_INFO()</a></code>.</p>
<h1><a class="anchor" id="basicAppsComp_adef"></a>
Create adef File</h1>
<p><code>4</code>. Create an <code>adef</code> file called <code>helloWorld.adef</code> like this:</p>
<pre class="fragment">executables:
{
    helloWorld = ( hello.c )
}

processes:
{
    run:
    {
        (helloWorld)
    }
}
</pre><p>This defines one executable called helloWorld implemented by <code>hello.c</code>, and then starts one instance of the helloWorld executable.</p>
<p>If your executable has multiple source files, add more files inside the parentheses after the executable name: "helloWorld ( hello.c foo.c )".</p>
<h1><a class="anchor" id="basicAppsComp_cdef"></a>
Create cdef File</h1>
<p><code>5</code>. Create a <code>cdef</code> file called <code>Component.cdef</code> like this:</p>
<pre class="fragment">$ gedit helloComp/Component.cdef
</pre><p>See <a class="el" href="def_files.html">Definition Files</a> for complete info.</p>
<h1><a class="anchor" id="buildApp"></a>
Build App</h1>
<p><code>6</code>. Run <code>mkapp</code> to build the executable and bundle it into an app.</p>
<p>Use the <code>-t</code> option to build a target other than the default "localhost" target.</p>
<p>This is how to build the helloWorld app for a device running the Sierra Wireless WP7 module:</p>
<pre class="fragment">$ mkapp -t wp7 helloWorld.adef
</pre><dl class="section note"><dt>Note</dt><dd>If you're building an AR7 app, substitute <code>ar7</code> for <code>wp7</code> in the mkapp run command.</dd></dl>
<h1><a class="anchor" id="basicAppsComp_inst"></a>
Install App to Target</h1>
<p><code>7</code>. Use <code>instapp</code> to install the app on your target.</p>
<pre class="fragment">$ instapp helloWorld.wp7 &lt;ip addr&gt;
</pre><p>The second argument tells the target device host address from where to run the app. This will connect to the target, upload the app, and start it.</p>
<dl class="section note"><dt>Note</dt><dd>Your installed app's output will not appear on the terminal you used to install the app. It will go into the syslog buffer on the target device, which can be viewed using <code>logread</code>.</dd></dl>
<h1><a class="anchor" id="basicAppsComp_usage"></a>
Usage</h1>
<p>Here's some quick usage tips:</p>
<h2><a class="anchor" id="basicAppsComp_usageRunLogs"></a>
Run Logs</h2>
<p>Your installed app's <code>LE_INFO</code> log message will appear in the system log ("syslog") on the target device.</p>
<p>Run <code>logread</code> (on the target) to view the system log.</p>
<pre class="fragment"># logread
</pre><p>Use logread's <em>-f</em> option to start monitoring the logs and display messages as they are logged.</p>
<pre class="fragment"># logread -f
</pre><h2><a class="anchor" id="basicAppsComp_usageRmApp"></a>
Remove App</h2>
<p>Use <code>rmapp</code> to uninstall your app.</p>
<pre class="fragment">$ rmapp helloWorld.wp7 &lt;ip addr&gt;
</pre><h2><a class="anchor" id="basicAppsComp_usageLsApp"></a>
List App</h2>
<p>Use <code>lsapp</code> to list the apps installed on a target.</p>
<pre class="fragment">$ lsapp &lt;ip addr&gt;
</pre><hr/>
<p>Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
