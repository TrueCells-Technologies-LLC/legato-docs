<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LEGATO: Set and Read the User Time timebase of the Real Time Clock (RTC)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying IoT development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_rtc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Set and Read the User Time timebase of the Real Time Clock (RTC) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__rtc__interface_8h.html">API Reference</a></p>
<hr/>
<p>This API provides definitions for reading and setting the "user" timebase of the RTC.</p>
<p>The modem manages a real time clock (battery backed clock VCOIN) which keeps time when the power is removed from the legato module (provided that a clock battery is provided). This clock is used by the modem to maintain several time bases which are variously derived from cellular networks or from GPS. Applications should not directly change the value of the real time clock as it may have undesirable effects on modem function. However, a user time base is provided which is synchronized with the RTC so an arbitrary time stored here will increment on a millisecond basis and can be retrieved later even after power down provided that a battery (VCOIN) is provided to keep the RTC running.</p>
<p>The RTC counts milliseconds since the GPS Epoch which is Jan 6, 1980, and increments on each count so that each second in GPS time has a unique number. This is different from Unix time which starts Jan 1, 1970 and has a fixed number of seconds per day so for days that have an extra second in them (leap second) Unix uses the same second twice. This means that over the years an ever increasing number of leap seconds have to be accounted for when converting time between these domains. Leap seconds are introduced periodically because the earths rotation is not constant and is slowing over time such that astronomically measured time and clock time would drift apart but for these adjustments. Unfortunately it also means that Unix time, GPS time and clock time are all drifting apart as well. Fortunately the rate of drift is low with only 26 leap seconds having been added since leap seconds were introduced in 1972. Unfortunately, due to the vagaries of planetary dynamics, it is impossible to predict in which years leap seconds will be added as that calculation must be done retroactively based on observation.</p>
<p>For practical purposes it is not necessary to convert the time you wish to maintain into real GPS time and it will suffice to use Unix epoch time. The amount of drift caused by leap seconds over a year is orders of less than the inherent drift in the RTC and we can expect that most users won't notice a second here or there and that under normal conditions the time will be corrected from an external source such as network time or GPS. If you are synchronising with cellular network time only, then this facility is already provided by the time-service daemon which will update the system time (the time you get when calling <a class="el" href="le__clock_8h.html#a33197dbd676a37b8c4d5de8f93edc1ee">le_clk_GetAbsoluteTime()</a> or using linux 'date' command) automatically, but if you are setting the system time yourself from a saved user time value you should probably disable the time service by commenting out the TIME_SERVICES="qcom_time" line in /etc/time_service.conf to prevent the system time from being updated if the modem receives a new time from a cellular network.</p>
<p>Note also that the time stored in the user timebase is incremented on a millisecond basis and unix time is incremented by the second so when storing unix time in the user time base it must be multiplied by 1000 and, conversely, must be divided by 1000 when retrieved.</p>
<hr/>
<p>Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.9.1
        </div>
    </div>
</body>
</html>
